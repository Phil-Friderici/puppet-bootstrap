#!/bin/bash

if [ "$1" == "--start" ]; then
  /usr/bin/nsupdate -k "/etc/ddns-update/ec2.key" -v <<EOF
server ns0.ukcod.org.uk
zone <%= @ddns_domain %>
update delete <%= @host_name %>.<%= @ddns_domain %> A
update delete <%= @host_name %>.<%= @ddns_domain %> AAAA
update add <%= @host_name %>.<%= @ddns_domain %> 60 A <%= @public_ipv4 %>
update add <%= @host_name %>.<%= @ddns_domain %> 60 AAAA <%= @ipv6_address %>
send
EOF
elif [ "$1" == "--stop" ]; then
  /usr/bin/nsupdate -k "/etc/ddns-update/ec2.key" -v <<EOF
server ns0.ukcod.org.uk
zone <%= @ddns_domain %>
update delete <%= @host_name %>.<%= @ddns_domain %> A
update delete <%= @host_name %>.<%= @ddns_domain %> AAAA
send
EOF
else
  exit 1
fi

exit $?
